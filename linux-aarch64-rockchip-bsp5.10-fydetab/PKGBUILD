# Maintainer: Samuel (kwankiu)

_kernel=linux-aarch64-rockchip-bsp5.10-fydetab
pkgver=5.10.110.37.27a257394
pkgbase=$_kernel
pkgname=($pkgbase)
pkgrel=1
arch=('aarch64')
license=('GPL2')
options=('!strip')
makedepends=('binutils' 'tar' 'grep' 'mkinitcpio' 'sed')
pkgdesc="Precompiled FydeTab Rockchip BSP 5.10 Linux kernel package"

source=("https://github.com/kwankiu/archlinux-installer/releases/download/kernel/fydetab-duo-kernel-bin.tar.xz")
sha256sums=('SKIP')

_package() {
  pkgdesc="FydeTab Rockchip BSP 5.10 Linux kernel"
  depends=('coreutils' 'linux-firmware' 'kmod' 'grep' 'gzip')
  optdepends=('crda: to set the correct wireless channels of your country')
  provides=("linux=${pkgver}")
  conflicts=('linux')

  cd "$srcdir"

  # copy everything
  cp -r . "$pkgdir"

  #install -dm755 "$pkgdir/boot"
  #install -dm755 "$pkgdir/usr"
  
  # copy dtbs
  #mkdir -p "$pkgdir/boot/dtbs/$_kernel"
  #cp -raf "usr/lib/linux-image-${_preversion}/." "$pkgdir/boot/dtbs/$_kernel"

  # copy modules
  #cp -r lib "$pkgdir/usr/lib"

  # copy kernel, bootlaoder can not load compressed kernels
  #chmod +x ../extract-vmlinux
  #../extract-vmlinux "boot/vmlinuz-${_preversion}" > "$pkgdir/usr/lib/modules/$_preversion/vmlinuz"

}

for _p in "${pkgname[@]}"; do
  eval "package_$_p() {
    $(declare -f "_package${_p#$_kernel}")
    _package${_p#$_kernel}
  }"
done