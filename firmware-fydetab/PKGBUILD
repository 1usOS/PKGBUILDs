# Maintainer: Panda <panda@fydeos.io>

pkgname=firmware-fydetab
pkgver=20$(date +%y%m%d)
pkgrel=1
pkgdesc="Fixes for FydeTab Duo"
arch=('any')
url="https://fydetabduo.com/"
license=('GPL')
source=('fydetabduo.service'
        'fix-display'
        'fix-display.service'
        '50-suspend-state.conf'
        'fydetab.rules'
        '90-fydetab.hwdb'
        'https://github.com/openFyde/overlay-fydetab_duo-openfyde/raw/r120-dev/chromeos-base/chromeos-bsp-fydetab_duo-openfyde/files/firmware/Himax_firmware.bin')
sha256sums=('SKIP'
            '18f5dbc2275ebfbfac69332948c9775cacaea44d35fc1788eae457ce3cebcb19'
            '5eff8eb75f3c32d27dc623ec68271b56905f5483b11bd39dc878c75e83369ceb'
            '65f367929918a34c260c8b6a00c8fa64a2c2c346bef505985ce1048069445367'
            '36b5a7bcffc598d22136f920478e47592fbf6e8396ddb4eef4636652b4007e6b'
            'cf4a7fcd770d4c176128257a1a63360bc0b4da5bb85a46f61cff88aff9d02537'
            'SKIP')

package() {
    install -Dm644 "${srcdir}/fydetabduo.service" "${pkgdir}/usr/lib/systemd/system/fydetabduo.service"
    install -Dm644 "${srcdir}/50-suspend-state.conf" "${pkgdir}/usr/lib/systemd/system/sleep.conf.d"
    install -Dm644 "${srcdir}/fix-display.service" "${pkgdir}/usr/lib/systemd/system/fix-display.service"
    install -Dm644 "${srcdir}/Himax_firmware.bin" "${pkgdir}/usr/lib/firmware/Himax_firmware.bin"
    mkdir -p "${pkgdir}/etc/udev/rules.d/"
    install -Dm644 "${srcdir}/fydetab.rules" "${pkgdir}/etc/udev/rules.d/"
    mkdir -p "${pkgdir}/usr/lib/udev/hwdb.d"
    install -Dm644 "${srcdir}/90-fydetab.hwdb" "${pkgdir}/usr/lib/udev/hwdb.d/"
    install -Dm755 "${srcdir}/fix-display" "${pkgdir}/usr/bin/fix-display"
}

post_install() {
    echo "Enabling system services ..."
    systemctl enable fydetabduo.service
    systemctl enable fix-display.service
}
